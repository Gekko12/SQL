/*
Company database ....... queries solved from VTU modal question papers
Executed in mySQL
*/

SHOW DATABASES;
CREATE DATABASE COMPANY_DB;
USE COMPANY_DB;

/*				TABLE CREATION					*/
CREATE TABLE EMPLOYEE
( FNAME VARCHAR(20),
MINIT VARCHAR(20),
LNAME VARCHAR(20),
SSN INTEGER,
BDATE DATE,
ADDRESS VARCHAR(50),
SEX CHAR(1),
SALARY NUMERIC(10, 2),
SUPER_SSN INTEGER,
DNO INTEGER,
FOREIGN KEY(SUPER_SSN) REFERENCES EMPLOYEE(SSN),
PRIMARY KEY(SSN));
DESC EMPLOYEE;

CREATE TABLE DEPARTMENT
( DNAME VARCHAR(20),
DNUMBER INTEGER PRIMARY KEY,
MGR_SSN INTEGER,
FOREIGN KEY(MGR_SSN) REFERENCES EMPLOYEE(SSN),
MGR_START_DATE DATE);
DESC DEPARTMENT;

ALTER TABLE EMPLOYEE
ADD FOREIGN KEY(DNO) REFERENCES DEPARTMENT(DNUMBER);

CREATE TABLE DEPT_LOCATIONS
( DNUMBER INTEGER,
DLOCATION VARCHAR(30),
FOREIGN KEY(DNUMBER) REFERENCES DEPARTMENT(DNUMBER),
PRIMARY KEY(DNUMBER, DLOCATION));
DESC DEPT_LOCATIONS;

CREATE TABLE PROJECT
( PNAME VARCHAR(20),
PNUMBER INTEGER,
PLOCATION VARCHAR(20),
DNUM INTEGER,
FOREIGN KEY(DNUM) REFERENCES DEPARTMENT(DNUMBER),
PRIMARY KEY(PNUMBER, PLOCATION));
DESC PROJECT;

CREATE TABLE WORKS_ON
( ESSN INTEGER,
PNO INTEGER,
HOURS NUMERIC(3, 1),
FOREIGN KEY(ESSN) REFERENCES EMPLOYEE(SSN),
FOREIGN KEY(PNO) REFERENCES PROJECT(PNUMBER));
DESC WORKS_ON;

CREATE TABLE DEPENDENT
( ESSN INTEGER,
DEPENDENT_NAME VARCHAR(30),
SEX CHAR(1),
BDATE DATE,
RELATIONSHIP VARCHAR(20),
FOREIGN KEY(ESSN) REFERENCES EMPLOYEE(SSN),
PRIMARY KEY(ESSN, DEPENDENT_NAME));
DESC DEPENDENT;


/*				INSERTION 				*/
INSERT INTO EMPLOYEE(FNAME, MINIT, LNAME, SSN, BDATE, ADDRESS, SEX, SALARY) VALUES
('JOHN', 'B', 'SMITH', 123456789, '1965-01-09', '731 FONDREN, HOUSTON, TX', 'M', 30000),
('FRANKLIN', 'T', 'WONG', 333445555, '1955-12-08', '638 VOSS, HOUSTON, TX', 'M', 40000),
('ALICIA', 'J', 'ZELAYA', 999887777, '1968-01-19', '3321 CASTLE, SPRING, TX', 'F', 25000),
('JENNIFER', 'S', 'WALLACE', 987654321, '1941-06-20', '291 BERRY, BELLAIRE, TX', 'F', 43000),
('RAMESH', 'K', 'NARAYAN', 666884444, '1962-09-15', '975 FIRE OAK, HUMBLE, TX', 'M', 38000),
('JOYCE', 'A', 'ENGLISH', 453453453, '1972-07-31', '5631 RICE, HOUSTON, TX', 'F', 25000),
('AHMAD', 'V', 'JABBAR', 987987987, '1969-03-29', '980 DALLAS, HOUSTON, TX', 'M', 25000),
('JAMES', 'E', 'BORG', 888665555, '1937-11-10', '450 STONE, HOUSTON, TX', 'M', 55000);

INSERT INTO DEPARTMENT VALUES
('RESEARCH', 5, 333445555, '1988-05-22'),
('ADMINISTRATION', 4, 987654321, '1995-01-01'),
('HEADQUARTERS', 1, 888665555, '1981-06-19');
SELECT * FROM DEPARTMENT;

UPDATE EMPLOYEE
SET SUPER_SSN=333445555, DNO=5
WHERE SSN=123456789;

UPDATE EMPLOYEE
SET SUPER_SSN=888665555, DNO=5
WHERE SSN=333445555;

UPDATE EMPLOYEE
SET SUPER_SSN=987654321, DNO=4
WHERE SSN=999887777;

UPDATE EMPLOYEE
SET SUPER_SSN=888665555, DNO=4
WHERE SSN=987654321;

UPDATE EMPLOYEE
SET SUPER_SSN=333445555, DNO=5
WHERE SSN=666884444;

UPDATE EMPLOYEE
SET SUPER_SSN=333445555, DNO=5
WHERE SSN=453453453;

UPDATE EMPLOYEE
SET SUPER_SSN=987654321, DNO=4
WHERE SSN=987987987;

UPDATE EMPLOYEE
SET SUPER_SSN=NULL, DNO=1
WHERE SSN=888665555;

SELECT * FROM EMPLOYEE;

INSERT INTO DEPT_LOCATIONS VALUES
(1, 'HOUSTAN'),
(4, 'STAFFORD'),
(5, 'BELLAIRE'),
(5, 'SUGARLAND'),
(5, 'HOUSTAN');
SELECT * FROM DEPT_LOCATIONS;

INSERT INTO PROJECT VALUES
('PRODUCTX', 1, 'BELLAIRE', 5),
('PRODUCTY', 2, 'SUGARLAND', 5),
('PRODUCTZ', 3, 'HOUSTAN', 5),
('COMPUTERIZATION', 10, 'STAFFORD', 4),
('REORAGANIZATION', 20, 'HOUSTAN', 1),
('NEWBENEFITS', 30, 'STAFFORD', 4);
SELECT * FROM PROJECT;

INSERT INTO WORKS_ON VALUES
(123456789, 1, 32.5),
(123456789, 2, 7.5),
(666884444, 3, 40.0),
(453453453, 1, 20.0),
(453453453, 2, 20.0),
(333445555, 2, 10.0),
(333445555, 3, 10.0),
(333445555, 10, 10.0),
(333445555, 20, 10.0),
(999887777, 30, 30.0),
(999887777, 10, 10.0),
(987987987, 10, 35.0),
(987987987, 30, 5.0),
(987654321, 30, 20.0),
(987654321, 20, 15.0),
(888665555, 20, NULL);
SELECT * FROM WORKS_ON;

INSERT INTO DEPENDENT VALUES
(333445555, 'ALICE', 'F', '1986-04-05', 'DAUGHTER'),
(333445555, 'THEODORE', 'M', '1983-10-25', 'SON'),
(333445555, 'JOY', 'F', '1958-05-03', 'SPOUSE'),
(987654321, 'ABNER', 'M', '1942-02-28', 'SPOUSE'),
(123456789, 'MICHAEL', 'M', '1988-01-04', 'SON'),
(123456789, 'ALICE', 'F', '1986-12-30', 'DAUGHTER'),
(123456789, 'ELIZABETH', 'F', '1967-05-05', 'SPOUSE');
SELECT * FROM DEPENDENT;


/*					QUERIES 					*/
/* retrieve all the employee who're working for department number 5 */
SELECT E.FNAME, E.MINIT, E.LNAME
FROM EMPLOYEE E
WHERE DNO = 5;

/* retrieve all projects which are controlled by department number 4  */
SELECT P.*
FROM PROJECT P
WHERE DNUM = 4;

/* retrieve the names of employee who have no dependents  */
SELECT E.FNAME, E.MINIT, E.LNAME
FROM EMPLOYEE E
WHERE NOT E.SSN IN (SELECT ESSN FROM DEPENDENT); 

/* retrieve all the employee name who is working on all the projects in which John Smith works on  */
SELECT E.FNAME, E.MINIT, E.LNAME
FROM EMPLOYEE E


 





