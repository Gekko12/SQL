/*
Order Database
*/

SHOW DATABASES;
CREATE DATABASE ORDER_DB;
USE ORDER_DB;
SHOW TABLES;


/*	TABLE CREATION		*/
CREATE TABLE SALESMAN
(SALESMAN_ID INTEGER PRIMARY KEY,
NAME VARCHAR(20),
CITY VARCHAR(20),
COMMISSION VARCHAR(10));
DESC SALESMAN;

CREATE TABLE CUSTOMER
(CUSTOMER_ID INTEGER PRIMARY KEY,
CUST_NAME VARCHAR(30),
CITY VARCHAR(20),
GRADE INTEGER,
SALESMAN_ID INTEGER,
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE SET NULL);
DESC CUSTOMER;

CREATE TABLE ORDERS
(ORD_NO INTEGER PRIMARY KEY,
PURCHASE_AMT NUMERIC(10,2),
ORD_DATE DATE,
CUSTOMER_ID INTEGER,
SALESMAN_ID INTEGER,
FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE,
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE);
DESC ORDERS;


/* INESRTION OF VALUES TO TABLES	*/
INSERT INTO SALESMAN VALUES
(1000, 'JOHN', 'BANGALORE', '25%'),
(2000, 'RAVI', 'BANGALORE', '20%'),
(3000, 'KUMAR', 'MYSORE', '15%'),
(4000, 'SMITH', 'DELHI', '30%'),
(5000, 'HARSHA', 'HYDERABAD', '15%');
SELECT * FROM SALESMAN;

INSERT INTO CUSTOMER VALUES
(10, 'PREETHI', 'BANGALORE', 100, 1000),
(11, 'VIVEK', 'MANGALORE', 300, 1000),
(12, 'BHASKAR', 'CHENNAI', 400, 2000),
(13, 'CHETAN', 'BANGALORE', 200, 2000),
(14, 'MAMTHA', 'BANGALORE', 400, 3000);
SELECT * FROM CUSTOMER;

INSERT INTO ORDERS VALUES
(50, 5000, '2017-05-04', 10, 1000),
(51, 450, '2017-01-20', 10, 2000),
(52, 1000, '2017-02-24', 13, 2000),
(53, 3500, '2017-04-13', 14, 3000),
(54, 550, '2017-03-09', 12, 2000);
SELECT * FROM ORDERS;


/* 	QUERIES 		*/
SELECT GRADE , COUNT(DISTINCT CUSTOMER_ID) 
FROM CUSTOMER
GROUP BY GRADE
HAVING GRADE > (SELECT AVG(GRADE) FROM CUSTOMER WHERE CITY = 'BANGALORE');

SELECT S.NAME, S.SALESMAN_ID
FROM SALESMAN S
GROUP BY SALESMAN_ID
HAVING 1 < (SELECT COUNT(SALESMAN_ID) FROM CUSTOMER C WHERE C.SALESMAN_ID = S.SALESMAN_ID);
/* 	OR	*/
SELECT S.NAME, S.SALESMAN_ID
FROM SALESMAN S
WHERE 1 < (SELECT COUNT(*) FROM CUSTOMER C WHERE C.SALESMAN_ID = S.SALESMAN_ID);

(SELECT S.NAME, S.SALESMAN_ID, C.CUST_NAME
FROM SALESMAN S, CUSTOMER C
WHERE S.CITY = C.CITY)
UNION
(SELECT S.NAME, S.SALESMAN_ID, 'NO MATCH'
FROM SALESMAN S
WHERE NOT S.CITY = ANY (SELECT C.CITY FROM CUSTOMER C))
ORDER BY 2 DESC;
/* HERE 2 IN THE ORDER STMT IS THE 2ND ATTRIBUTE FROM THAT REFERENCE WE HAVE TO SORT */

DROP VIEW IF EXISTS V_ELITE_SALESMAN;
CREATE VIEW V_ELITE_SALESMAN
AS SELECT O.ORD_NO, S.NAME, O.ORD_DATE
FROM ORDERS O, SALESMAN S
WHERE O.SALESMAN_ID = S.SALESMAN_ID
AND PURCHASE_AMT = (SELECT MAX(PURCHASE_AMT) FROM ORDERS AS B WHERE O.ORD_DATE = B.ORD_DATE);
SELECT * FROM V_ELITE_SALESMAN;

DELETE FROM ORDERS
WHERE SALESMAN_ID = 1000;
SELECT * FROM ORDERS;




